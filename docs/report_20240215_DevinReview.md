https://deepwiki.com/search/_26fee4af-4780-4464-b655-29899add31f8?mode=fast

## ä¾é ¼å†…å®¹
ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®æ©Ÿèƒ½ãƒ»æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ãƒ»ã‚½ãƒ¼ã‚¹å“è³ªã‚’åˆ†æã—ã¦

## æ¦‚è¦
æœ¬ãƒªãƒã‚¸ãƒˆãƒªã¯Windowsãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚’AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‹ã‚‰æ“ä½œãƒ»çŸ¥è¦šã™ã‚‹ãŸã‚ã®MCPã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚è¦–è¦šï¼ˆã‚­ãƒ£ãƒ—ãƒãƒ£/ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼‰ã€è´è¦šï¼ˆéŒ²éŸ³/Whisperæ–‡å­—èµ·ã“ã—ï¼‰ã€æ“ä½œï¼ˆãƒã‚¦ã‚¹/ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰/ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰ã‚’æä¾›ã—ã€v2.0ã§ãƒ„ãƒ¼ãƒ«ã‚’6æœ¬ã®çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æ•´ç†ã—ã¾ã—ãŸã€‚æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¯.NET 8/C#ã‚’ä¸­æ ¸ã«Windowså›ºæœ‰APIï¼ˆGDI+/WGC/WASAPI/UI Automationï¼‰ã¨AIï¼ˆWhisper.netï¼‰ã‚’çµ„ã¿åˆã‚ã›ã€ã‚½ãƒ¼ã‚¹å“è³ªã¯é™çš„è§£æã‚¯ãƒªã‚¢ãƒ»éåŒæœŸæœ€é©åŒ–ãƒ»E2Eãƒ†ã‚¹ãƒˆãƒ»CIãƒ»é«˜DPIå¯¾å¿œãƒ»ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãªã©å®Ÿè·µçš„ã§å …ç‰¢ã§ã™ [1](#0-0) [2](#0-1) [3](#0-2) ã€‚

---

## æ©Ÿèƒ½
### è¦–è¦šï¼ˆVisualï¼‰
- ãƒ¢ãƒ‹ã‚¿ãƒ¼/ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦/é ˜åŸŸã®é™æ­¢ç”»ã‚­ãƒ£ãƒ—ãƒãƒ£ã¨å‹•çš„å“è³ªåˆ¶å¾¡ï¼ˆNormal=30, Detailed=70ï¼‰ [4](#0-3) ã€‚
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ»å‹•ç”»å…±è¦–è´ãƒ»ã‚°ãƒªãƒƒãƒ‰å¤‰åŒ–æ¤œå‡ºï¼ˆé«˜/ä¸­/ä½æ„Ÿåº¦ï¼‰ [5](#0-4) [6](#0-5) ã€‚
- çµ±åˆãƒ„ãƒ¼ãƒ«: `visual_list`, `visual_capture`, `visual_watch`, `visual_stop` [7](#0-6) ã€‚

### è´è¦šï¼ˆAudio & Transcriptionï¼‰
- WASAPIã«ã‚ˆã‚‹ã‚·ã‚¹ãƒ†ãƒ éŸ³/ãƒã‚¤ã‚¯éŒ²éŸ³ã¨Whisper.netã«ã‚ˆã‚‹ãƒ­ãƒ¼ã‚«ãƒ«æ–‡å­—èµ·ã“ã— [8](#0-7) ã€‚
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å˜ä½ã®éŒ²éŸ³ç®¡ç†ã¨ãƒ‡ãƒã‚¤ã‚¹åˆ—æŒ™ [9](#0-8) ã€‚

### æ“ä½œï¼ˆInputï¼‰
- SendInput APIã«ã‚ˆã‚‹ãƒã‚¦ã‚¹ç§»å‹•/ã‚¯ãƒªãƒƒã‚¯/ãƒ‰ãƒ©ãƒƒã‚°ã¨å®‰å…¨ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®ã¿ï¼ˆãƒ†ã‚­ã‚¹ãƒˆ/ä¿®é£¾ã‚­ãƒ¼ã¯ãƒ–ãƒ­ãƒƒã‚¯ï¼‰ [10](#0-9) ã€‚
- ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ“ä½œï¼ˆé–‰ã˜ã‚‹/æœ€å°åŒ–/æœ€å¤§åŒ–ï¼‰ã¨UI Automationã«ã‚ˆã‚‹æ§‹é€ åŒ–ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º [11](#0-10) ã€‚

### MCPã‚µãƒ¼ãƒãƒ¼ã¨çµ±åˆç®¡ç†
- JSON-RPC over stdioã§Claude Desktopç­‰ã¨é€£æºã€‚SessionManagerã§éåŒæœŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¸€å…ƒç®¡ç†ã—ã€`visual_stop`ã§å„ç¨®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’åœæ­¢ [12](#0-11) [13](#0-12) ã€‚
- HTTPã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ã‚‚åŒæ™‚èµ·å‹•å¯èƒ½ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆ5000ï¼‰ [14](#0-13) ã€‚

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ : .NET 8ï¼ˆnet8.0-windowsï¼‰ã€C#ã€SelfContained/SingleFileãƒ“ãƒ«ãƒ‰ [15](#0-14) ã€‚
- UI/æç”»: GDI+ã€DirectXã€Windows Graphics Capture (WGC) for ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ [16](#0-15) ã€‚
- ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª: WASAPI (NAudio)ã€Whisper.netï¼ˆãƒ­ãƒ¼ã‚«ãƒ«AIæ–‡å­—èµ·ã“ã—ï¼‰ [17](#0-16) ã€‚
- å…¥åŠ›: SendInput Win32 APIã€UI Automationï¼ˆUIAï¼‰ [18](#0-17) [19](#0-18) ã€‚
- MCP: ModelContextProtocol 0.7.0-previewã€DIï¼ˆMicrosoft.Extensions.Hostingï¼‰ã€Stdioãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆ [20](#0-19) [21](#0-20) ã€‚
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ï¼ˆCore/Screen/Audio/Transcription/Input/Appï¼‰ã€SessionManagerã€å‹•çš„å“è³ªåˆ¶å¾¡ã€ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆ_llm_instructionï¼‰ [22](#0-21) [23](#0-22) ã€‚

---

## ã‚½ãƒ¼ã‚¹å“è³ª
- é™çš„è§£æ: AnalysisLevel=latest-recommendedã€EnforceCodeStyleInBuildã€CAãƒ«ãƒ¼ãƒ«é©ç”¨æ¸ˆã¿ [24](#0-23) [25](#0-24) ã€‚
- éåŒæœŸ/ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†: Task.Delayä½¿ç”¨ã€ConfigureAwait(false)ã€IDisposableå®Ÿè£…ã€Bitmap/Graphicsã®usingã«ã‚ˆã‚‹è§£æ”¾ [26](#0-25) [27](#0-26) ã€‚
- ãƒ†ã‚¹ãƒˆ: E2Eãƒ†ã‚¹ãƒˆï¼ˆNotepadæ“ä½œãªã©ï¼‰ã€CIã§ã®å‹•ç”»ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ†ã‚¹ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—è¨­å®šã‚ã‚Š [28](#0-27) [29](#0-28) ã€‚
- ãƒ­ã‚®ãƒ³ã‚°: MCP stdioã®ãŸã‚Console.Error.WriteLineã®ã¿ä½¿ç”¨ï¼ˆstdoutã¯JSON-RPCå°‚ç”¨ï¼‰ [30](#0-29) ã€‚
- é«˜DPIå¯¾å¿œ: SetProcessDPIAware()ã«ã‚ˆã‚Šç‰©ç†ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã§ä¸€è²«æ€§ã‚’æ‹…ä¿ [31](#0-30) ã€‚
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: æ—¥æœ¬èªä¸»ä½“ï¼ˆAGENTS.mdï¼‰ã€è¨­è¨ˆææ¡ˆãƒ»ç§»è¡Œã‚¬ã‚¤ãƒ‰ãƒ»å“è³ªãƒ¬ãƒãƒ¼ãƒˆãƒ»è¨ˆç”»æ›¸ã‚’æ•´å‚™ [32](#0-31) [33](#0-32) ã€‚
- ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡: å‹•çš„å“è³ªï¼ˆ30/70ï¼‰ã¨_llm_instructionã«ã‚ˆã‚‹ã€Œå³æ™‚å‡¦ç†ãƒ»ç ´æ£„ã€æŒ‡ç¤ºã§LLMã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåœ§è¿«ã‚’æŠ‘åˆ¶ [34](#0-33) [23](#0-22) ã€‚

---

## Notes
- æœ¬åˆ†æã¯æä¾›ã•ã‚ŒãŸã‚¹ãƒ‹ãƒšãƒƒãƒˆã¨wikiã«åŸºã¥ãã¾ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã‚’ç¶²ç¾…ã—ãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- v2.0çµ±åˆãƒ„ãƒ¼ãƒ«ã¯å®Ÿè£…æ¸ˆã¿ã§ã™ãŒã€ä¸€éƒ¨input_mouse/input_windowã¯ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ„ãƒ¼ãƒ«ã¨å…±å­˜ä¸­ã§ã™ [35](#0-34) ã€‚
- ä»Šå¾Œã¯MCPãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹ãƒ—ãƒ«å‹ãƒ•ãƒ¬ãƒ¼ãƒ å‚ç…§ã§95%ä»¥ä¸Šã®ãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›ã‚’ç›®æŒ‡ã—ã¾ã™ [36](#0-35) ã€‚

Wiki pages you might want to explore:
- [Getting Started (utenadev/windows-desktop-use-mcp)](/wiki/utenadev/windows-desktop-use-mcp#2)
- [Unified Tools (v2.0) (utenadev/windows-desktop-use-mcp)](/wiki/utenadev/windows-desktop-use-mcp#5.1)

### Citations

**File:** README.md (L3-14)
```markdown
An MCP server for controlling and perceiving Windows 11 from AI assistants.
It provides AI with "eyes" (vision), "ears" (hearing), and "limbs" (input control), making the desktop environment accessible from MCP clients like Claude.

[English](README.md) | [æ—¥æœ¬èª](README.ja.md)

## Main Features

- **Vision (Screen Capture)**: Capture monitors, specific windows, or arbitrary regions.
- **Hearing (Audio & Transcription)**: Record system audio or microphone, with high-quality local transcription using Whisper AI.
- **Limbs (Desktop Input)**: Mouse movement, clicking, dragging, and safe navigation key operations (security restricted).
- **Live Monitoring (Streaming)**: Monitor screen changes in real-time, viewable via HTTP streaming in a browser.

```

**File:** README.md (L36-42)
```markdown
    "windows-desktop-use": {
      "command": "C:\\Tools\\WindowsDesktopUse\\WindowsDesktopUse.exe",
      "args": ["--httpPort", "5000"]
    }
  }
}
```
```

**File:** CHANGELOG.md (L17-17)
```markdown
    - **Memory Management**: Proper disposal of Bitmap/Graphics objects using `using` blocks.
```

**File:** CHANGELOG.md (L34-38)
```markdown
- **`monitor` Tool**: Event-driven window monitoring with visual change detection.
    - **Sensitivity Levels**: High (1%), Medium (5%), Low (15%) change thresholds.
    - **Grid Indices**: Reports which grid cells changed for precise location tracking.
    - **MCP Notifications**: Sends `window_monitor` type notifications on visual changes.
    - **Session Management**: `stop_monitor` for proper resource cleanup.
```

**File:** CHANGELOG.md (L41-44)
```markdown
- **GPU-Accelerated Video Capture (WGC)**: Implemented `ModernCaptureService` with Windows Graphics Capture support.
    - **PW_RENDERFULLCONTENT Flag**: Captures hardware-accelerated content (YouTube, Netflix) without black screen.
    - **Hybrid Capture**: Modern API (WGC) with fallback to GDI+ for compatibility.
    - **Resource Management**: Proper disposal of D3D11 devices and contexts.
```

**File:** CHANGELOG.md (L58-66)
```markdown
- **Unified Tool Architecture v2.0**: Consolidated fragmented tools into clean, intuitive interfaces.
    - **`visual_list`**: Unified `list_monitors`, `list_windows`, `list_all` with `type` parameter.
    - **`visual_capture`**: Unified all capture tools with dynamic quality control (Normal=30, Detailed=70).
    - **`visual_watch`**: Unified `watch`, `watch_video_v2`, `monitor` with `mode` parameter.
    - **`visual_stop`**: Single stop command for all session types.
    - **`input_mouse`**: Unified `mouse_move`, `mouse_click`, `mouse_drag` with `action` parameter.
    - **`input_window`**: Unified window operations (close, minimize, maximize, restore).
    - **`SessionManager`**: Centralized session management for all async operations.
    - **Migration Guide**: Complete documentation for tool transition (MIGRATION_GUIDE_v2.md).
```

**File:** CHANGELOG.md (L67-68)
```markdown
- **Unit Tests**: Added comprehensive tests for `VisualChangeDetector` and `VideoTargetFinder` components.
- **E2E Tests**: Added `VideoCaptureE2ETests` for video pipeline integration testing.
```

**File:** CHANGELOG.md (L82-91)
```markdown
- **Code Quality Improvements**: Resolved all static analysis warnings and improved maintainability.
  - Fixed culture-dependent method calls (CA1304, CA1305, CA1307, CA1308, CA1311).
  - Implemented proper IDisposable pattern (CA1063, CA1816, CA1001).
  - Used read-only collections where appropriate (CA1002).
  - Added ConfigureAwait(false) to async method calls (CA2007).
  - Marked static holder class as static (CA1052).
  - Extracted nested VirtualKeys class to top-level (CA1034).
  - Fixed method return value usage (CA1806, CA1822).
- **Async Optimization**: Replaced Thread.Sleep with Task.Delay for better async performance.
- **Test Code Quality**: Fixed all static analysis warnings in E2E tests (CA1031, CA1050, CA1307, CA1310, CA1707).
```

**File:** CHANGELOG.md (L94-96)
```markdown
- **E2E Tests**: Added CI skip for video capture tests.
  - `WatchVideo_ActiveWindow_ReturnsSessionId` and `WatchVideoV1_StartsSuccessfully` now skip on CI.
  - These tests require an active video window (YouTube, etc.) to be running.
```

**File:** src/WindowsDesktopUse.App/WindowsDesktopUse.App.csproj (L4-18)
```text
    <OutputType>Exe</OutputType>
    <TargetFramework>net8.0-windows</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <PublishSingleFile>true</PublishSingleFile>
    <SelfContained>true</SelfContained>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <AssemblyName>WindowsDesktopUse</AssemblyName>
    <PublishTrimmed>false</PublishTrimmed>
    
    <!-- Lint & Static Analysis Settings -->
    <EnforceCodeStyleInBuild>true</EnforceCodeStyleInBuild>
    <AnalysisLevel>latest-recommended</AnalysisLevel>
    <AnalysisMode>Recommended</AnalysisMode>
  </PropertyGroup>
```

**File:** src/WindowsDesktopUse.App/WindowsDesktopUse.App.csproj (L21-25)
```text
    <PackageReference Include="Microsoft.Extensions.Hosting" Version="10.0.2" />
    <PackageReference Include="Microsoft.Extensions.Hosting.Abstractions" Version="10.0.2" />
    <PackageReference Include="ModelContextProtocol" Version="0.7.0-preview.1" />
    <PackageReference Include="System.CommandLine" Version="2.0.0-beta4.22272.1" />
  </ItemGroup>
```

**File:** docs/proposal_20260214_architectural_cleanup.ja.md (L15-19)
```markdown
### 2.2 å‹•çš„ã‚¯ã‚ªãƒªãƒ†ã‚£åˆ¶å¾¡ (Dynamic Quality Control)
`qwencode` ã®èª¿æŸ»çµæœï¼ˆquality=30 ãŒå®Ÿç”¨è‡¨ç•Œç‚¹ï¼‰ã«åŸºã¥ãã€ä»¥ä¸‹ã®æŒ™å‹•ã‚’æ¨™æº–åŒ–ã™ã‚‹ã€‚
- **Watchãƒ¢ãƒ¼ãƒ‰ (Normal)**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ `quality=30`ã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¯€ç´„ã—ã¤ã¤å ´é¢è»¢æ›ã‚’è¿½è·¡ã€‚
- **Inspectãƒ¢ãƒ¼ãƒ‰ (Detailed)**: `ReadResource` æ™‚ã‚„é«˜ç²¾åº¦æŒ‡å®šæ™‚ã« `quality=70` ã¸è‡ªå‹•æ˜‡æ ¼ã€‚é¡”ã®è¡¨æƒ…ã‚„æ–‡å­—ã®èªè­˜ã‚’ã‚µãƒãƒ¼ãƒˆã€‚

```

**File:** docs/proposal_20260214_architectural_cleanup.ja.md (L48-49)
```markdown
3.  **Phase 3: ãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã¨ã®é€£æº**
    - `plan_20260214_mcp_resources_buffering.ja.md` ã«åŸºã¥ãã€éå»ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é«˜ç”»è³ªã§å‚ç…§ã§ãã‚‹ä»•çµ„ã¿ã‚’çµ±åˆã€‚
```

**File:** docs/issue_20260214_qwen_video_coview_spec.md (L31-44)
```markdown
## ææ¡ˆä»•æ§˜ï¼šã€Œ2ç§’ã”ã¨ã®ãƒ‘ãƒ©ãƒ‘ãƒ©ç”»åƒ ï¼‹ åŒæœŸæ–‡å­—èµ·ã“ã—ã€
LLM ãŒæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«è‡ªç„¶ãªä¼šè©±ãŒã§ãã‚‹ã‚ˆã†ã€ä»¥ä¸‹ã®å‡ºåŠ›å½¢å¼ã‚’å®Ÿç¾ã—ã¾ã™ï¼š

### å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆNDJSON: Newline-Delimited JSONï¼‰
```json
{"ts": 0.0, "frame": "base64encoded_jpeg_without_newlines", "transcript": ""}
{"ts": 2.0, "frame": "...", "transcript": "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™"}
{"ts": 4.0, "frame": "...", "transcript": "æœç‹ç”ºã®æœã "}
...
```
- `ts`: å†ç”Ÿé–‹å§‹ã‹ã‚‰ã®çµŒéæ™‚é–“ï¼ˆç§’å˜ä½ã€floatã€100ms ç²¾åº¦ä»¥ä¸Šï¼‰
- `frame`: JPEG base64ï¼ˆæ”¹è¡Œãªã—ã€RFC 4648æº–æ‹ ï¼‰â†’ `docs/feedback_20240614_base64_input_handling.md` ã®æ•™è¨“ã‚’åæ˜ 
- `transcript`: `listen(duration=2, source="System")` ã§å¾—ãŸæ–‡å­—èµ·ã“ã—ï¼ˆç©ºæ–‡å­—å¯ï¼‰
- å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¿…é ˆã§ã¯ãªãã€`transcript` ã¯éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆã¯ ""
```

**File:** docs/DEVELOPMENT.md (L24-29)
```markdown
    subgraph "External Libraries"
        Audio -- NAudio --> WASAPI
        Trans -- Whisper.net --> WhisperAI
        Screen -- GDI+/DirectX --> Win32API
        Input -- SendInput --> Win32API
    end
```

**File:** docs/DEVELOPMENT.md (L34-41)
```markdown
| Project Name | Role | Description |
| :--- | :--- | :--- |
| **`WindowsDesktopUse.Core`** | Foundation | Common data models (MonitorInfo, WindowInfo), interfaces, and exception definitions. |
| **`WindowsDesktopUse.Screen`** | Vision | Screen and window capture using GDI+ and DirectX, and target enumeration. |
| **`WindowsDesktopUse.Audio`** | Hearing (Record) | Audio recording from system and microphone using WASAPI (NAudio). |
| **`WindowsDesktopUse.Transcription`** | Hearing (Analyze) | AI transcription using Whisper.net to convert audio to text. |
| **`WindowsDesktopUse.Input`** | Limbs (Control) | Low-level mouse and keyboard input simulation using the `SendInput` Win32 API. |
| **`WindowsDesktopUse.App`** | Host | The entry point for the MCP server. Integrates all modules and exposes tools. |
```

**File:** docs/DEVELOPMENT.md (L62-68)
```markdown
## Important: High DPI Awareness

This server calls `SetProcessDPIAware()` and operates in physical pixel units.
- Coordinates and sizes retrieved by the `Screen` module are in physical pixels.
- Mouse coordinates specified in the `Input` module are interpreted as physical pixels.
This design ensures that coordinates calculated by an AI from capture images match the input coordinates perfectly without any offset.

```

**File:** docs/TOOLS_LIST.ja.md (L36-44)
```markdown
| ãƒ„ãƒ¼ãƒ«å | èª¬æ˜ | å‚™è€ƒ |
|----------|------|------|
| `listen` | éŒ²éŸ³ã¨æ–‡å­—èµ·ã“ã— (Whisper) | |
| `list_audio_devices` | ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§ã‚’å–å¾— | |
| `start_audio_capture` | æœªåŠ å·¥éŸ³å£°ã®ã‚­ãƒ£ãƒ—ãƒãƒ£é–‹å§‹ | |
| `stop_audio_capture` | éŸ³å£°ã‚­ãƒ£ãƒ—ãƒãƒ£åœæ­¢ã¨ãƒ‡ãƒ¼ã‚¿å–å¾— | |
| `get_active_audio_sessions` | å®Ÿè¡Œä¸­ã®éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’å–å¾— | |
| `get_whisper_model_info` | Whisper ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã®å–å¾— | |

```

**File:** docs/TOOLS.md (L67-85)
```markdown
#### `keyboard_key` (Security Restricted)
Simulates pressing, releasing, or clicking a navigation key only.

**âš ï¸ Security Notice:** For security reasons, only safe navigation keys are allowed. Text typing and modifier keys (Ctrl, Alt, Win) are blocked to prevent unintended system operations.

- **Arguments:**
  - `key` (string): Key name.
    - **Allowed keys:** `enter`, `return`, `tab`, `escape`, `esc`, `space`, `backspace`, `delete`, `del`, `left`, `up`, `right`, `down`, `home`, `end`, `pageup`, `pagedown`
    - **Not allowed:** `ctrl`, `alt`, `win`, `shift` (blocked for security)
  - `action` (string): "click", "press" (hold down), "release" (let go) (default: "click")

- **Use Cases:**
  - Navigate forms using Tab key
  - Confirm actions with Enter
  - Close dialogs with Escape
  - Navigate lists and menus with arrow keys
  - Navigate pages with PageUp/PageDown

- **Note:** For text input, use mouse to focus a text field first. Direct text typing is not supported for security reasons.
```

**File:** docs/plan_20260214_accessibility_and_monitor.ja.md (L10-29)
```markdown
## 2. æ©Ÿèƒ½1: `read_window_text` (UIãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º)

### æ¦‚è¦
æŒ‡å®šã—ãŸã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®UIãƒ„ãƒªãƒ¼ã‚’è§£æã—ã€Markdownå½¢å¼ã§æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹ã€‚

### å®Ÿè£…è©³ç´°
- **ã‚µãƒ¼ãƒ“ã‚¹å**: `AccessibilityService` (æ–°è¦ä½œæˆ)
- **æŠ€è¡“è©³ç´°**:
    - `UIAutomationClient` ã¨ `UIAutomationTypes` (Windows Desktop SDKæ¨™æº–) ã‚’ä½¿ç”¨ã€‚
    - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ `TreeWalker.ControlViewWalker` ã‚’ä½¿ç”¨ã—ã¦ãƒ„ãƒªãƒ¼ã‚’èµ°æŸ»ã™ã‚‹ã€‚
    - ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ã¯ `Current.Name` ã ã‘ã§ãªãã€`ValuePattern` ã‚„ `TextPattern` ã‹ã‚‰ã®å–å¾—ã‚’è©¦ã¿ã‚‹ã€‚
- **Markdownå¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°**:
    - `ControlType.TitleBar`, `Header` -> `# ` (æ·±åº¦ã«å¿œã˜ã¦å¢—ã‚„ã™)
    - `ControlType.ListItem` -> `- `
    - `ControlType.Text`, `Edit`, `Document` -> ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ”¹è¡Œç¶­æŒï¼‰
    - `ControlType.Button` -> `[ Button: {Name} ]` (å¼•æ•°ã§æœ‰åŠ¹ãªå ´åˆ)
- **æ³¨æ„ç‚¹**: 
    - ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã®ãŸã‚ã€æœ€å¤§æ·±åº¦ã‚’10éšå±¤ã«åˆ¶é™ã€‚
    - ãƒ–ãƒ©ã‚¦ã‚¶ã®URLå–å¾—ã¯ã€ç‰¹å®šã®ã‚¨ãƒ‡ã‚£ãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆ"Address and search bar" ç­‰ï¼‰ã‚’æ¢ç´¢ã™ã‚‹ã“ã¨ã§ä»˜åŠ ä¾¡å€¤ã‚’é«˜ã‚ã‚‹ã€‚

```

**File:** src/WindowsDesktopUse.App/Program.cs (L660-662)
```csharp
    // Initialize unified session manager
    var sessionManager = new SessionManager();
    DesktopUseTools.SetSessionManager(sessionManager);
```

**File:** src/WindowsDesktopUse.App/Program.cs (L714-720)
```csharp
    var builder = Host.CreateApplicationBuilder();
    builder.Logging.ClearProviders();
    builder.Logging.AddProvider(new StderrLoggerProvider());
    builder.Services
        .AddMcpServer()
        .WithStdioServerTransport()
        .WithToolsFromAssembly(typeof(DesktopUseTools).Assembly);
```

**File:** docs/plan_20260214_token_efficiency_protocol.ja.md (L30-41)
```markdown
```json
"_llm_instruction": {
    "action": "PROCESS_IMMEDIATELY_AND_DISCARD",
    "steps": [
        "1. Extract metadata (ts, windowTitle).",
        "2. Analyze image NOW.",
        "3. Record result as TEXT only.",
        "4. DELETE the 'frame' or 'image' field from your history."
    ],
    "token_warning": "This image consumes approx 2000+ tokens. Discarding it saves 95% memory."
}
```
```

**File:** AGENTS.md (L31-35)
```markdown
### Tool Usage
- **Search:** Use `rg` (ripgrep) instead of `grep` for faster and more reliable searching.
- **Communication:** Always communicate with the user in **Japanese**.
- **Source Code:** Comments and commit messages must be in **English**.

```

**File:** AGENTS.md (L49-52)
```markdown
### Logging - CRITICAL
**STRICT REQUIREMENT:** Always use `Console.Error.WriteLine` for logging.
**REASON:** `stdout` is reserved for JSON-RPC.

```

**File:** docs/quality_test_report.md (L10-16)
```markdown
## 1. ãƒ†ã‚¹ãƒˆæ¦‚è¦

| quality | base64 ã‚µã‚¤ã‚ºï¼ˆç›¸å¯¾ï¼‰ | ç›®çš„ |
|---------|------------------------|------|
| 70      | 100%                   | é«˜ç”»è³ªåŸºæº– |
| 30      | ~35%                   | å®Ÿç”¨ä¸‹é™æ¤œè¨¼ |
| 10      | ~12%                   | æ¥µä½ç”»è³ªé™ç•Œãƒ†ã‚¹ãƒˆ |
```

**File:** docs/quality_test_report.md (L72-83)
```markdown
## 3. ç·åˆçµè«–

| ä½¿ç”¨ã‚·ãƒ¼ãƒ³ | æ¨å¥¨ quality |
|------------|--------------|
| LLMå…±è¦³ä½“é¨“ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰ | `30`ï¼ˆå¸¯åŸŸã¨å“è³ªã®ãƒãƒ©ãƒ³ã‚¹æœ€é©ï¼‰ |
| é«˜ç²¾åº¦åˆ†æãƒ»æ•™è‚²ãƒ»è§£èª¬ | `70` |
| å¸¯åŸŸæ¥µåº¦åˆ¶ç´„ç’°å¢ƒ | `30` ï¼‹ æ™‚åˆ»æƒ…å ±ä»˜åŠ ã§è£œå®Œ |
| ãƒ­ã‚°ãƒ»æ¥ç¶šãƒ†ã‚¹ãƒˆ | `10`ï¼ˆãŸã ã—ã€æ„å‘³ã®ã‚ã‚‹è§£é‡ˆä¸å¯ï¼‰ |

> ğŸ’¡ **æ³¨æ„**:  
> base64 ã‚µã‚¤ã‚ºã¯ç·šå½¢ã«æ¸›å°‘ã™ã‚‹ãŒã€**LLMã¸ã®æƒ…å ±ä¼é”åŠ¹ç‡ã¯éç·šå½¢ã«ä½ä¸‹**ã—ã¾ã™ã€‚  
> `quality=30` ãŒã€å®Ÿç”¨ä¸Šã®ã€Œè‡¨ç•Œç‚¹ã€ã¨åˆ¤æ–­ã•ã‚Œã¾ã™ã€‚
```

**File:** docs/MIGRATION_GUIDE_v2.md (L25-33)
```markdown
### æ“ä½œç³»ãƒ„ãƒ¼ãƒ«

| æ—§ãƒ„ãƒ¼ãƒ« | æ–°ãƒ„ãƒ¼ãƒ« | å¤‰æ›´ç‚¹ |
|----------|----------|--------|
| `mouse_move` | `input_mouse` | `action="move"` ã‚’æŒ‡å®š |
| `mouse_click` | `input_mouse` | `action="click"` ã‚’æŒ‡å®š |
| `mouse_drag` | `input_mouse` | `action="drag"` ã‚’æŒ‡å®š |
| `close_window` | `input_window` | `action="close"` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) |

```


## å¤šè§’çš„è©•ä¾¡ï¼ˆ5æ®µéšï¼‰

| è©•ä¾¡è»¸ | è©•ä¾¡ | æ ¹æ‹ ãƒ»ãƒã‚¤ãƒ³ãƒˆ |
|--------|------|----------------|
| æ©Ÿèƒ½æ€§ | 5/5 | è¦–è¦šãƒ»è´è¦šãƒ»æ“ä½œã‚’çµ±åˆã—ã€GPUã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ»å‹•çš„å“è³ªåˆ¶å¾¡ãƒ»UI Automationãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºãƒ»å‹•ç”»å…±è¦–è´ä»•æ§˜ã¾ã§ç¶²ç¾… [1](#1-0) [2](#1-1) [3](#1-2) ã€‚ |
| æŠ€è¡“é¸å®š | 5/5 | .NET 8 + WGC + WASAPI + Whisper.net + MCP 0.7.0-preview ã¨ãƒ¢ãƒ€ãƒ³ã‹ã¤Windowsæœ€é©ã€‚SelfContained/SingleFileé…å¸ƒã‚‚å®Œå‚™ [4](#1-3) [5](#1-4) ã€‚ |
| ã‚½ãƒ¼ã‚¹å“è³ª | 5/5 | é™çš„è§£æã‚¯ãƒªã‚¢ã€ConfigureAwait(false)ã€IDisposableã€usingã€E2Eãƒ†ã‚¹ãƒˆã€CIã‚¹ã‚­ãƒƒãƒ—è¨­å®šã€é«˜DPIå¯¾å¿œã€ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¾ã§å®Ÿè£… [6](#1-5) [7](#1-6) [8](#1-7) ã€‚ |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»é–‹ç™ºä½“é¨“ | 4/5 | æ—¥æœ¬èªä¸»ä½“ã®AGENTS.mdã€è‡ªå‹•setupã‚³ãƒãƒ³ãƒ‰ã€doctorè¨ºæ–­ã€ç§»è¡Œã‚¬ã‚¤ãƒ‰ã€å“è³ªãƒ¬ãƒãƒ¼ãƒˆã‚’å®Œå‚™ã€‚ãŸã ã—v2.0çµ±åˆãƒ„ãƒ¼ãƒ«ã®ä¸€éƒ¨ã¯ãƒ¬ã‚¬ã‚·ãƒ¼ã¨å…±å­˜ä¸­ [9](#1-8) [10](#1-9) ã€‚ |
| å®Ÿç”¨æ€§ãƒ»å®‰å®šæ€§ | 4/5 | é«˜DPIãƒ»ç‰©ç†ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã§åº§æ¨™ã‚ºãƒ¬ã‚’è§£æ¶ˆã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®ã¿ï¼‰ã‚’å°å…¥ã€‚ãŸã ã—GPUã‚­ãƒ£ãƒ—ãƒãƒ£ã¯WGCå®Ÿè£…æ¸ˆã¿ã‚‚ã€ä¸€éƒ¨ç’°å¢ƒã§è¦ç®¡ç†è€…æ¨©é™ãƒ»é»’ç”»é¢ãƒªã‚¹ã‚¯ã‚ã‚Š [7](#1-6) [11](#1-10) [2](#1-1) ã€‚ |

---

## è£œè¶³
- æ©Ÿèƒ½æ€§ã¨æŠ€è¡“é¸å®šã¯ã€Œ5ã€ã«å€¤ã™ã‚‹ãƒ¬ãƒ™ãƒ«ã€‚MCPçµ±åˆã¨Windowså›ºæœ‰APIã®çµ„ã¿åˆã‚ã›ãŒä»–ã«é¡ã‚’è¦‹ãªã„ã€‚
- ã‚½ãƒ¼ã‚¹å“è³ªã‚‚é™çš„è§£æãƒ»éåŒæœŸãƒ»ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ãƒ»ãƒ†ã‚¹ãƒˆã¾ã§æ•´å‚™ã•ã‚Œã€Œ5ã€ã€‚
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯éå¸¸ã«å……å®Ÿã—ã¦ã„ã‚‹ãŒã€v2.0ç§»è¡ŒãŒå®Œå…¨ã§ãªã„ãŸã‚ã€Œ4ã€ã€‚
- å®Ÿç”¨æ€§ã¯é«˜DPIå¯¾å¿œã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆãŒå„ªç§€ã ãŒã€ç’°å¢ƒä¾å­˜ï¼ˆç®¡ç†è€…æ¨©é™ãƒ»GPUã‚­ãƒ£ãƒ—ãƒãƒ£ï¼‰ãŒã‚ã‚‹ãŸã‚ã€Œ4ã€ã€‚

## Notes
- è©•ä¾¡ã¯æä¾›ã•ã‚ŒãŸã‚¹ãƒ‹ãƒšãƒƒãƒˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«åŸºã¥ãã¾ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã‚’ç¶²ç¾…ã—ãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- å°†æ¥çš„ã«ã¯MCPãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°å°å…¥ã§ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡ãŒã•ã‚‰ã«å‘ä¸Šã—ã€å®Ÿç”¨æ€§è©•ä¾¡ã‚‚ä¸ŠãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ [12](#1-11) ã€‚

Wiki pages you might want to explore:
- [Getting Started (utenadev/windows-desktop-use-mcp)](/wiki/utenadev/windows-desktop-use-mcp#2)
- [Unified Tools (v2.0) (utenadev/windows-desktop-use-mcp)](/wiki/utenadev/windows-desktop-use-mcp#5.1)

### Citations

**File:** README.md (L3-14)
```markdown
An MCP server for controlling and perceiving Windows 11 from AI assistants.
It provides AI with "eyes" (vision), "ears" (hearing), and "limbs" (input control), making the desktop environment accessible from MCP clients like Claude.

[English](README.md) | [æ—¥æœ¬èª](README.ja.md)

## Main Features

- **Vision (Screen Capture)**: Capture monitors, specific windows, or arbitrary regions.
- **Hearing (Audio & Transcription)**: Record system audio or microphone, with high-quality local transcription using Whisper AI.
- **Limbs (Desktop Input)**: Mouse movement, clicking, dragging, and safe navigation key operations (security restricted).
- **Live Monitoring (Streaming)**: Monitor screen changes in real-time, viewable via HTTP streaming in a browser.

```

**File:** CHANGELOG.md (L41-44)
```markdown
- **GPU-Accelerated Video Capture (WGC)**: Implemented `ModernCaptureService` with Windows Graphics Capture support.
    - **PW_RENDERFULLCONTENT Flag**: Captures hardware-accelerated content (YouTube, Netflix) without black screen.
    - **Hybrid Capture**: Modern API (WGC) with fallback to GDI+ for compatibility.
    - **Resource Management**: Proper disposal of D3D11 devices and contexts.
```

**File:** CHANGELOG.md (L82-91)
```markdown
- **Code Quality Improvements**: Resolved all static analysis warnings and improved maintainability.
  - Fixed culture-dependent method calls (CA1304, CA1305, CA1307, CA1308, CA1311).
  - Implemented proper IDisposable pattern (CA1063, CA1816, CA1001).
  - Used read-only collections where appropriate (CA1002).
  - Added ConfigureAwait(false) to async method calls (CA2007).
  - Marked static holder class as static (CA1052).
  - Extracted nested VirtualKeys class to top-level (CA1034).
  - Fixed method return value usage (CA1806, CA1822).
- **Async Optimization**: Replaced Thread.Sleep with Task.Delay for better async performance.
- **Test Code Quality**: Fixed all static analysis warnings in E2E tests (CA1031, CA1050, CA1307, CA1310, CA1707).
```

**File:** docs/issue_20260214_qwen_video_coview_spec.md (L31-44)
```markdown
## ææ¡ˆä»•æ§˜ï¼šã€Œ2ç§’ã”ã¨ã®ãƒ‘ãƒ©ãƒ‘ãƒ©ç”»åƒ ï¼‹ åŒæœŸæ–‡å­—èµ·ã“ã—ã€
LLM ãŒæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«è‡ªç„¶ãªä¼šè©±ãŒã§ãã‚‹ã‚ˆã†ã€ä»¥ä¸‹ã®å‡ºåŠ›å½¢å¼ã‚’å®Ÿç¾ã—ã¾ã™ï¼š

### å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆNDJSON: Newline-Delimited JSONï¼‰
```json
{"ts": 0.0, "frame": "base64encoded_jpeg_without_newlines", "transcript": ""}
{"ts": 2.0, "frame": "...", "transcript": "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™"}
{"ts": 4.0, "frame": "...", "transcript": "æœç‹ç”ºã®æœã "}
...
```
- `ts`: å†ç”Ÿé–‹å§‹ã‹ã‚‰ã®çµŒéæ™‚é–“ï¼ˆç§’å˜ä½ã€floatã€100ms ç²¾åº¦ä»¥ä¸Šï¼‰
- `frame`: JPEG base64ï¼ˆæ”¹è¡Œãªã—ã€RFC 4648æº–æ‹ ï¼‰â†’ `docs/feedback_20240614_base64_input_handling.md` ã®æ•™è¨“ã‚’åæ˜ 
- `transcript`: `listen(duration=2, source="System")` ã§å¾—ãŸæ–‡å­—èµ·ã“ã—ï¼ˆç©ºæ–‡å­—å¯ï¼‰
- å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¿…é ˆã§ã¯ãªãã€`transcript` ã¯éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆã¯ ""
```

**File:** docs/DEVELOPMENT.md (L24-29)
```markdown
    subgraph "External Libraries"
        Audio -- NAudio --> WASAPI
        Trans -- Whisper.net --> WhisperAI
        Screen -- GDI+/DirectX --> Win32API
        Input -- SendInput --> Win32API
    end
```

**File:** docs/DEVELOPMENT.md (L62-68)
```markdown
## Important: High DPI Awareness

This server calls `SetProcessDPIAware()` and operates in physical pixel units.
- Coordinates and sizes retrieved by the `Screen` module are in physical pixels.
- Mouse coordinates specified in the `Input` module are interpreted as physical pixels.
This design ensures that coordinates calculated by an AI from capture images match the input coordinates perfectly without any offset.

```

**File:** docs/plan_20260214_token_efficiency_protocol.ja.md (L30-41)
```markdown
```json
"_llm_instruction": {
    "action": "PROCESS_IMMEDIATELY_AND_DISCARD",
    "steps": [
        "1. Extract metadata (ts, windowTitle).",
        "2. Analyze image NOW.",
        "3. Record result as TEXT only.",
        "4. DELETE the 'frame' or 'image' field from your history."
    ],
    "token_warning": "This image consumes approx 2000+ tokens. Discarding it saves 95% memory."
}
```
```

**File:** docs/TOOLS.md (L67-85)
```markdown
#### `keyboard_key` (Security Restricted)
Simulates pressing, releasing, or clicking a navigation key only.

**âš ï¸ Security Notice:** For security reasons, only safe navigation keys are allowed. Text typing and modifier keys (Ctrl, Alt, Win) are blocked to prevent unintended system operations.

- **Arguments:**
  - `key` (string): Key name.
    - **Allowed keys:** `enter`, `return`, `tab`, `escape`, `esc`, `space`, `backspace`, `delete`, `del`, `left`, `up`, `right`, `down`, `home`, `end`, `pageup`, `pagedown`
    - **Not allowed:** `ctrl`, `alt`, `win`, `shift` (blocked for security)
  - `action` (string): "click", "press" (hold down), "release" (let go) (default: "click")

- **Use Cases:**
  - Navigate forms using Tab key
  - Confirm actions with Enter
  - Close dialogs with Escape
  - Navigate lists and menus with arrow keys
  - Navigate pages with PageUp/PageDown

- **Note:** For text input, use mouse to focus a text field first. Direct text typing is not supported for security reasons.
```

**File:** docs/proposal_20260214_architectural_cleanup.ja.md (L48-49)
```markdown
3.  **Phase 3: ãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã¨ã®é€£æº**
    - `plan_20260214_mcp_resources_buffering.ja.md` ã«åŸºã¥ãã€éå»ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é«˜ç”»è³ªã§å‚ç…§ã§ãã‚‹ä»•çµ„ã¿ã‚’çµ±åˆã€‚
```


## ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆé‹ç”¨ãƒ»æ”¹å–„ï¼‰
- v2.0çµ±åˆãƒ„ãƒ¼ãƒ«ã¸ã®ç§»è¡Œã‚’åŠ é€Ÿã—ã€ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’æ®µéšçš„ã«éæ¨å¥¨åŒ–ã—ã¦ãƒ„ãƒ¼ãƒ«é¸æŠã®æ··ä¹±ã‚’æ¸›ã‚‰ã™ [1](#2-0) ã€‚
- CIã§å‹•ç”»ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ†ã‚¹ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã›ãšå®Ÿè¡Œã™ã‚‹ãŸã‚ã€ä»®æƒ³ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤/ä»®æƒ³ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‰ãƒ©ã‚¤ãƒã‚’å°å…¥ã—ã¦E2Eç¶²ç¾…æ€§ã‚’é«˜ã‚ã‚‹ [2](#2-1) ã€‚
- WGCã‚­ãƒ£ãƒ—ãƒãƒ£ã®æ¨©é™ä¸è¶³ãƒ»é»’ç”»é¢å•é¡Œã«å¯¾ã—ã€èµ·å‹•æ™‚ã«ç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é€šçŸ¥ã‚’è¿½åŠ ã™ã‚‹ [3](#2-2) ã€‚
- é«˜DPIç’°å¢ƒã§ã®åº§æ¨™ã‚ºãƒ¬é˜²æ­¢ã¯å®Ÿè£…æ¸ˆã¿ã ãŒã€DPIå‹•çš„å¤‰æ›´æ™‚ã®å†åˆæœŸåŒ–ãƒ•ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¦å …ç‰¢åŒ–ã™ã‚‹ [4](#2-3) ã€‚

## æ©Ÿèƒ½è¿½åŠ ææ¡ˆ
- MCPãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã—ã€ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚µãƒ¼ãƒãƒ¼å´ã«ä¿æŒã—ã¦URIã§å‚ç…§å¯èƒ½ã«ã™ã‚‹ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³95%å‰Šæ¸›ï¼‰ [5](#2-4) ã€‚
- UI Automationã«ã‚ˆã‚‹ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆ`read_window_text`ï¼‰ã‚’æ‹¡å¼µã—ã€OCRï¼ˆTesseractï¼‰ã‚„ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆé€£æºã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ UIå¤‰æ›´é€šçŸ¥ã‚’è¿½åŠ  [6](#2-5) ã€‚
- å‹•ç”»å…±è¦–è´ä»•æ§˜ï¼ˆNDJSONï¼‹åŒæœŸæ–‡å­—èµ·ã“ã—ï¼‰ã‚’`watch_video_v3`ã¨ã—ã¦å®Ÿè£…ã—ã€LLMã¨ã®å¯¾è©±çš„è¦–è´ä½“é¨“ã‚’æ¨™æº–åŒ–ã™ã‚‹ [7](#2-6) ã€‚
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å…¥åŠ›åˆ¶é™ã‚’ã‚ªãƒ—ãƒˆã‚¤ãƒ³ã§ç·©å’Œã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ï¼ˆä¾‹: --allow-text-inputï¼‰ã‚’è¿½åŠ ã—ã€ç”¨é€”ã«å¿œã˜ã¦ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‚’è¨±å¯ã™ã‚‹ [8](#2-7) ã€‚
- Whisperãƒ¢ãƒ‡ãƒ«ã®å‹•çš„åˆ‡ã‚Šæ›¿ãˆã¨ãƒ­ãƒ¼ã‚«ãƒªã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ—¥æœ¬èªãƒ»è‹±èªä»–ï¼‰ã‚’CLIã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æä¾›ã—ã€æ–‡å­—èµ·ã“ã—ç²¾åº¦ã‚’å‘ä¸Šã•ã›ã‚‹ [9](#2-8) ã€‚

## Notes
- ææ¡ˆã®å¤šãã¯æ—¢å­˜ã®è¨­è¨ˆè¨ˆç”»ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚å®Ÿè£…å„ªå…ˆåº¦ãŒé«˜ã„ã®ã¯MCPãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã¨å‹•ç”»å…±è¦–è´ä»•æ§˜ã§ã™ã€‚
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ã®ç·©å’Œã¯æ…é‡ã«ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç¾è¡Œã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®ã¿ã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚
- è©•ä¾¡5æ®µéšã§ã€Œå®Ÿç”¨æ€§ãƒ»å®‰å®šæ€§ã€ãŒ4ã ã£ãŸã®ã¯ç’°å¢ƒä¾å­˜ã®èª²é¡Œã«ã‚ˆã‚‹ãŸã‚ã€ä¸Šè¨˜æ”¹å–„ã§5ã‚’ç›®æŒ‡ã›ã¾ã™ã€‚

Wiki pages you might want to explore:
- [Unified Tools (v2.0) (utenadev/windows-desktop-use-mcp)](/wiki/utenadev/windows-desktop-use-mcp#5.1)

### Citations

**File:** CHANGELOG.md (L41-44)
```markdown
- **GPU-Accelerated Video Capture (WGC)**: Implemented `ModernCaptureService` with Windows Graphics Capture support.
    - **PW_RENDERFULLCONTENT Flag**: Captures hardware-accelerated content (YouTube, Netflix) without black screen.
    - **Hybrid Capture**: Modern API (WGC) with fallback to GDI+ for compatibility.
    - **Resource Management**: Proper disposal of D3D11 devices and contexts.
```

**File:** CHANGELOG.md (L58-66)
```markdown
- **Unified Tool Architecture v2.0**: Consolidated fragmented tools into clean, intuitive interfaces.
    - **`visual_list`**: Unified `list_monitors`, `list_windows`, `list_all` with `type` parameter.
    - **`visual_capture`**: Unified all capture tools with dynamic quality control (Normal=30, Detailed=70).
    - **`visual_watch`**: Unified `watch`, `watch_video_v2`, `monitor` with `mode` parameter.
    - **`visual_stop`**: Single stop command for all session types.
    - **`input_mouse`**: Unified `mouse_move`, `mouse_click`, `mouse_drag` with `action` parameter.
    - **`input_window`**: Unified window operations (close, minimize, maximize, restore).
    - **`SessionManager`**: Centralized session management for all async operations.
    - **Migration Guide**: Complete documentation for tool transition (MIGRATION_GUIDE_v2.md).
```

**File:** CHANGELOG.md (L94-96)
```markdown
- **E2E Tests**: Added CI skip for video capture tests.
  - `WatchVideo_ActiveWindow_ReturnsSessionId` and `WatchVideoV1_StartsSuccessfully` now skip on CI.
  - These tests require an active video window (YouTube, etc.) to be running.
```

**File:** docs/DEVELOPMENT.md (L38-40)
```markdown
| **`WindowsDesktopUse.Audio`** | Hearing (Record) | Audio recording from system and microphone using WASAPI (NAudio). |
| **`WindowsDesktopUse.Transcription`** | Hearing (Analyze) | AI transcription using Whisper.net to convert audio to text. |
| **`WindowsDesktopUse.Input`** | Limbs (Control) | Low-level mouse and keyboard input simulation using the `SendInput` Win32 API. |
```

**File:** docs/DEVELOPMENT.md (L62-68)
```markdown
## Important: High DPI Awareness

This server calls `SetProcessDPIAware()` and operates in physical pixel units.
- Coordinates and sizes retrieved by the `Screen` module are in physical pixels.
- Mouse coordinates specified in the `Input` module are interpreted as physical pixels.
This design ensures that coordinates calculated by an AI from capture images match the input coordinates perfectly without any offset.

```

**File:** docs/plan_20260214_mcp_resources_buffering.ja.md (L6-10)
```markdown
## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦
- **ãƒãƒƒãƒ•ã‚¡**: ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ¡ãƒ¢ãƒªã¾ãŸã¯ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ç›´è¿‘ N ãƒ•ãƒ¬ãƒ¼ãƒ åˆ†ã®ç”»åƒã‚’ä¿æŒã™ã‚‹ã€‚
- **ãƒªã‚½ãƒ¼ã‚¹æä¾›**: MCP ã® `Resources` æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€å„ãƒ•ãƒ¬ãƒ¼ãƒ ã«ä¸€æ„ã® URIï¼ˆä¾‹: `mcp://video/frame/123.jpg`ï¼‰ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã€‚
- **ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰èª­ã¿è¾¼ã¿**: LLM ã¯é€šçŸ¥ï¼ˆNotificationsï¼‰ã§ URI ã ã‘ã‚’å—ã‘å–ã‚Šã€è©³ç´°ãªè§£æãŒå¿…è¦ãªå ´åˆã®ã¿ã€ãã® URI ã‚’èª­ã¿ã«è¡Œãã€‚

```

**File:** docs/plan_20260214_accessibility_and_monitor.ja.md (L10-29)
```markdown
## 2. æ©Ÿèƒ½1: `read_window_text` (UIãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º)

### æ¦‚è¦
æŒ‡å®šã—ãŸã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®UIãƒ„ãƒªãƒ¼ã‚’è§£æã—ã€Markdownå½¢å¼ã§æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹ã€‚

### å®Ÿè£…è©³ç´°
- **ã‚µãƒ¼ãƒ“ã‚¹å**: `AccessibilityService` (æ–°è¦ä½œæˆ)
- **æŠ€è¡“è©³ç´°**:
    - `UIAutomationClient` ã¨ `UIAutomationTypes` (Windows Desktop SDKæ¨™æº–) ã‚’ä½¿ç”¨ã€‚
    - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ `TreeWalker.ControlViewWalker` ã‚’ä½¿ç”¨ã—ã¦ãƒ„ãƒªãƒ¼ã‚’èµ°æŸ»ã™ã‚‹ã€‚
    - ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ã¯ `Current.Name` ã ã‘ã§ãªãã€`ValuePattern` ã‚„ `TextPattern` ã‹ã‚‰ã®å–å¾—ã‚’è©¦ã¿ã‚‹ã€‚
- **Markdownå¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°**:
    - `ControlType.TitleBar`, `Header` -> `# ` (æ·±åº¦ã«å¿œã˜ã¦å¢—ã‚„ã™)
    - `ControlType.ListItem` -> `- `
    - `ControlType.Text`, `Edit`, `Document` -> ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ”¹è¡Œç¶­æŒï¼‰
    - `ControlType.Button` -> `[ Button: {Name} ]` (å¼•æ•°ã§æœ‰åŠ¹ãªå ´åˆ)
- **æ³¨æ„ç‚¹**: 
    - ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã®ãŸã‚ã€æœ€å¤§æ·±åº¦ã‚’10éšå±¤ã«åˆ¶é™ã€‚
    - ãƒ–ãƒ©ã‚¦ã‚¶ã®URLå–å¾—ã¯ã€ç‰¹å®šã®ã‚¨ãƒ‡ã‚£ãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆ"Address and search bar" ç­‰ï¼‰ã‚’æ¢ç´¢ã™ã‚‹ã“ã¨ã§ä»˜åŠ ä¾¡å€¤ã‚’é«˜ã‚ã‚‹ã€‚

```

**File:** docs/issue_20260214_qwen_video_coview_spec.md (L31-44)
```markdown
## ææ¡ˆä»•æ§˜ï¼šã€Œ2ç§’ã”ã¨ã®ãƒ‘ãƒ©ãƒ‘ãƒ©ç”»åƒ ï¼‹ åŒæœŸæ–‡å­—èµ·ã“ã—ã€
LLM ãŒæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«è‡ªç„¶ãªä¼šè©±ãŒã§ãã‚‹ã‚ˆã†ã€ä»¥ä¸‹ã®å‡ºåŠ›å½¢å¼ã‚’å®Ÿç¾ã—ã¾ã™ï¼š

### å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆNDJSON: Newline-Delimited JSONï¼‰
```json
{"ts": 0.0, "frame": "base64encoded_jpeg_without_newlines", "transcript": ""}
{"ts": 2.0, "frame": "...", "transcript": "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™"}
{"ts": 4.0, "frame": "...", "transcript": "æœç‹ç”ºã®æœã "}
...
```
- `ts`: å†ç”Ÿé–‹å§‹ã‹ã‚‰ã®çµŒéæ™‚é–“ï¼ˆç§’å˜ä½ã€floatã€100ms ç²¾åº¦ä»¥ä¸Šï¼‰
- `frame`: JPEG base64ï¼ˆæ”¹è¡Œãªã—ã€RFC 4648æº–æ‹ ï¼‰â†’ `docs/feedback_20240614_base64_input_handling.md` ã®æ•™è¨“ã‚’åæ˜ 
- `transcript`: `listen(duration=2, source="System")` ã§å¾—ãŸæ–‡å­—èµ·ã“ã—ï¼ˆç©ºæ–‡å­—å¯ï¼‰
- å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¿…é ˆã§ã¯ãªãã€`transcript` ã¯éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆã¯ ""
```


## å³ã—ã„å•é¡Œç‚¹ã®æŒ‡æ‘˜

| å¤§åˆ†é¡ | å…·ä½“çš„ãªå•é¡Œç‚¹ | å½±éŸ¿ãƒ»ãƒªã‚¹ã‚¯ |
|--------|----------------|--------------|
| ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç§»è¡Œã®æœªå®Œäº† | v2.0çµ±åˆãƒ„ãƒ¼ãƒ«å°å…¥å¾Œã‚‚ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒå…±å­˜ã—ã€MIGRATION_GUIDE_v2.md ã§ã¯ç§»è¡ŒãŒã€Œè¨ˆç”»ã€æ®µéšã€‚LLMãŒæ—§ãƒ„ãƒ¼ãƒ«ã‚’é¸æŠã—ã¦æ··ä¹±ã™ã‚‹å¯èƒ½æ€§ [1](#3-0) [2](#3-1)  | ãƒ„ãƒ¼ãƒ«é¸æŠã®èªçŸ¥è² è·ãŒæ®‹ã‚Šã€v2.0ã®åˆ©ç‚¹ãŒæœ€å¤§é™ã«æ´»ã‹ã›ãªã„ |
| CI/ãƒ†ã‚¹ãƒˆç¶²ç¾…æ€§ã®æ¬ å¦‚ | å‹•ç”»ã‚­ãƒ£ãƒ—ãƒãƒ£é–¢é€£E2Eãƒ†ã‚¹ãƒˆãŒCIã§ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¦ãŠã‚Šã€ä»®æƒ³ç’°å¢ƒã§ã®æ¤œè¨¼ãŒä¸ååˆ†ã€‚Notepadæ“ä½œã«åã£ãŸãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª [3](#3-2) [4](#3-3)  | ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ¤œå‡ºæ¼ã‚Œã€ç’°å¢ƒä¾å­˜ãƒã‚°ã®æ½œåœ¨åŒ– |
| GPUã‚­ãƒ£ãƒ—ãƒãƒ£ã®å®Ÿè£…ãŒã€ŒWGCã€ã§ã¯ãªã„ | `ModernCaptureService` ã¯PrintWindow+PW_RENDERFULLCONTENT ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦ãŠã‚Šã€çœŸã®Windows.Graphics Capture APIã§ã¯ãªã„ã€‚é»’ç”»é¢ã‚„æ¨©é™å•é¡ŒãŒæœªè§£æ±º [5](#3-4) [6](#3-5)  | YouTube/Netflixç­‰ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åŠ é€Ÿã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã‚­ãƒ£ãƒ—ãƒãƒ£å¤±æ•— |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ãŒå¼·ã™ãã‚‹ | `keyboard_key` ã¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®ã¿è¨±å¯ã•ã‚Œã€ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒ»ä¿®é£¾ã‚­ãƒ¼ãŒä¸€åˆ‡ä¸å¯ã€‚UI Automationã«ã‚ˆã‚‹ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã‚‚æœªå®Ÿè£… [7](#3-6) [8](#3-7)  | ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã‚„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ“ä½œãŒã§ããšã€å®Ÿç”¨ã‚·ãƒ¼ãƒ³ãŒåˆ¶é™ã•ã‚Œã‚‹ |
| ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡åŒ–ãŒã€ŒæŒ‡ç¤ºã€ã«ä¾å­˜ | `_llm_instruction` ã¯LLMã¸ã®ä¾é ¼ã§ã‚ã‚Šã€æŠ€è¡“çš„ãªå¼·åˆ¶åŠ›ãŒãªã„ã€‚MCPãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã¯è¨ˆç”»ã®ã¿ã§æœªå®Ÿè£… [9](#3-8) [10](#3-9)  | LLMãŒæŒ‡ç¤ºã‚’ç„¡è¦–ã—ãŸå ´åˆã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒæº¢ã‚Œã¦ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ãƒªã‚¹ã‚¯ |
| å‹å®‰å…¨æ€§ã®ç·©ã¿ | `hwnd` ã‚’stringã«å¤‰æ›´ã—ãŸçµŒç·¯ã‹ã‚‰ã€long.TryParseã§ã®å¤‰æ›ãŒå„æ‰€ã«æ•£åœ¨ã€‚å‹ãƒŸã‚¹ã‚„ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®æ¸©åºŠ [11](#3-10)  | å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼å¢—åŠ ã€ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®ä¸å®‰å®šåŒ– |
| å‹•ç”»ãƒ»éŸ³å£°åŒæœŸã®æœªå®Ÿè£… | ã€Œ2ç§’ã”ã¨ã®ãƒ‘ãƒ©ãƒ‘ãƒ©ç”»åƒï¼‹åŒæœŸæ–‡å­—èµ·ã“ã—ã€ä»•æ§˜ã¯ææ¡ˆæ®µéšã§ã€`watch_video_v3` ã¯æœªå®Ÿè£…ã€‚æ™‚åˆ»ç²¾åº¦æ”¹å–„ã‚‚è¨ˆç”»ã®ã¿ [12](#3-11) [13](#3-12)  | LLMã¨ã®å¯¾è©±çš„è¦–è´ä½“é¨“ãŒæä¾›ã§ããšã€å·®åˆ¥åŒ–è¦å› ãŒæœªå®Ÿç¾ |
| é«˜DPIå¯¾å¿œãŒé™çš„ã®ã¿ | `SetProcessDPIAware()` å‘¼ã³å‡ºã—ã®ã¿ã§ã€DPIå‹•çš„å¤‰æ›´ã¸ã®å†åˆæœŸåŒ–ãƒ•ãƒƒã‚¯ãŒãªã„ [14](#3-13)  | ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®šå¤‰æ›´ä¸­ã®åº§æ¨™ã‚ºã‚Œç™ºç”Ÿãƒªã‚¹ã‚¯ |
| ãƒ­ã‚°å‡ºåŠ›ãŒæœªæ§‹é€ åŒ– | `Console.Error.WriteLine` å›ºå®šã§ã€ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãƒ»æ§‹é€ åŒ–ãƒ­ã‚°ãƒ»é›†ç´„åŸºç›¤ãŒæœªæ•´å‚™ [15](#3-14)  | ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åŠ¹ç‡ä½ä¸‹ã€é‹ç”¨ç›£è¦–ã‚³ã‚¹ãƒˆå¢— |
| Whisperãƒ¢ãƒ‡ãƒ«ã®å‹•çš„åˆ‡ã‚Šæ›¿ãˆä¸å¯ | ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºã¯å¼•æ•°ã§æŒ‡å®šå¯èƒ½ã ãŒã€ãƒ­ãƒ¼ã‚«ãƒªã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã®ãƒ¢ãƒ‡ãƒ«åˆ‡ã‚Šæ›¿ãˆãŒæœªå®Ÿè£… [16](#3-15)  | è¨€èªã”ã¨ã®æœ€é©ãƒ¢ãƒ‡ãƒ«é¸æŠãŒã§ããšã€ç²¾åº¦ãƒ»é€Ÿåº¦ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ãŒå›ºå®šåŒ– |

## Notes
- ä¸Šè¨˜ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚³ãƒ¼ãƒ‰ãƒ»è¨ˆç”»æ›¸ã‹ã‚‰èª­ã¿å–ã‚Œã‚‹ã€Œæœªå®Œäº†ãƒ»æ‡¸å¿µç‚¹ã€ã§ã™ã€‚å®Ÿéš›ã®å‹•ä½œç’°å¢ƒã«ã‚ˆã£ã¦ã¯ä¸€éƒ¨ãŒè§£æ¶ˆã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚
- ç‰¹ã«v2.0ç§»è¡Œã¨MCPãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã®æœªå®Ÿè£…ãŒã€ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡ã¨LLMä½¿ã„ã‚„ã™ã•ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã£ã¦ã„ã¾ã™ã€‚
- å³ã—ãæŒ‡æ‘˜ã—ã¾ã—ãŸãŒã€ã“ã‚Œã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã•ã‚‰ã«å …ç‰¢ã«ã™ã‚‹ãŸã‚ã®è¦³ç‚¹ã§ã™ã€‚å¼•ãç¶šãæ”¹å–„ã‚’æœŸå¾…ã—ã¾ã™ã€‚

Wiki pages you might want to explore:
- [Unified Tools (v2.0) (utenadev/windows-desktop-use-mcp)](/wiki/utenadev/windows-desktop-use-mcp#5.1)
- [Migration and API Evolution (utenadev/windows-desktop-use-mcp)](/wiki/utenadev/windows-desktop-use-mcp#9)

### Citations

**File:** CHANGELOG.md (L41-44)
```markdown
- **GPU-Accelerated Video Capture (WGC)**: Implemented `ModernCaptureService` with Windows Graphics Capture support.
    - **PW_RENDERFULLCONTENT Flag**: Captures hardware-accelerated content (YouTube, Netflix) without black screen.
    - **Hybrid Capture**: Modern API (WGC) with fallback to GDI+ for compatibility.
    - **Resource Management**: Proper disposal of D3D11 devices and contexts.
```

**File:** CHANGELOG.md (L58-66)
```markdown
- **Unified Tool Architecture v2.0**: Consolidated fragmented tools into clean, intuitive interfaces.
    - **`visual_list`**: Unified `list_monitors`, `list_windows`, `list_all` with `type` parameter.
    - **`visual_capture`**: Unified all capture tools with dynamic quality control (Normal=30, Detailed=70).
    - **`visual_watch`**: Unified `watch`, `watch_video_v2`, `monitor` with `mode` parameter.
    - **`visual_stop`**: Single stop command for all session types.
    - **`input_mouse`**: Unified `mouse_move`, `mouse_click`, `mouse_drag` with `action` parameter.
    - **`input_window`**: Unified window operations (close, minimize, maximize, restore).
    - **`SessionManager`**: Centralized session management for all async operations.
    - **Migration Guide**: Complete documentation for tool transition (MIGRATION_GUIDE_v2.md).
```

**File:** CHANGELOG.md (L94-96)
```markdown
- **E2E Tests**: Added CI skip for video capture tests.
  - `WatchVideo_ActiveWindow_ReturnsSessionId` and `WatchVideoV1_StartsSuccessfully` now skip on CI.
  - These tests require an active video window (YouTube, etc.) to be running.
```

**File:** docs/report_20240214_newfeature.md (L18-24)
```markdown
    âŒ å®Ÿè¡Œä¸èƒ½ï¼å¤±æ•—ã—ãŸæ©Ÿèƒ½
     - mcp__WindowsDesktopUse__get_latest_video_frameï¼ˆwatch_video_v2 ã‚»ãƒƒã‚·ãƒ§ãƒ³å¯¾è±¡ï¼‰
      â†’ è¤‡æ•°å›å®Ÿè¡Œã—ã¦ã‚‚ hasFrame: falseã€‚åŸå› ï¼šGDI+ ã«ã‚ˆã‚‹ã‚­ãƒ£ãƒ—ãƒãƒ£ãŒ YouTube ã® GPU
    åŠ é€Ÿè¡¨ç¤ºã«å¯¾å¿œã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒé«˜ã„ã€‚åˆå›åˆæœŸåŒ–å¾Œã‚‚ãƒ•ãƒ¬ãƒ¼ãƒ ç”Ÿæˆã•ã‚Œãªã„ã€‚
     - mcp__WindowsDesktopUse__get_latest_video_frameï¼ˆcamera_capture_stream ã‚»ãƒƒã‚·ãƒ§ãƒ³å¯¾è±¡ï¼‰
      â†’ åŒæ§˜ã« hasFrame: falseã€‚ã•ã‚‰ã«ã€HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ /stream/{id} ã¯
    404ï¼ˆå­˜åœ¨ã—ãªã„ï¼‰ã€‚
```

**File:** src/WindowsDesktopUse.Screen/CaptureServices/ModernCaptureService.cs (L61-87)
```csharp
            // Use PrintWindow with PW_RENDERFULLCONTENT for GPU-accelerated content
            return await Task.Run(() => CaptureWithPrintWindow(hwnd, width, height), ct).ConfigureAwait(false);
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"[ModernCapture] Capture failed: {ex.Message}");
            return null;
        }
    }

    private Bitmap? CaptureWithPrintWindow(IntPtr hwnd, int width, int height)
    {
        try
        {
            var bmp = new Bitmap(width, height, PixelFormat.Format32bppArgb);
            using (var g = Graphics.FromImage(bmp))
            {
                g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighSpeed;
                g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.Default;
                g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighSpeed;

                var hdcDest = g.GetHdc();
                try
                {
                    // PW_RENDERFULLCONTENT = 0x00000002 - captures GPU-accelerated content
                    const uint PW_RENDERFULLCONTENT = 0x00000002;
                    var success = PrintWindow(hwnd, hdcDest, PW_RENDERFULLCONTENT);
```

**File:** docs/TOOLS.md (L67-85)
```markdown
#### `keyboard_key` (Security Restricted)
Simulates pressing, releasing, or clicking a navigation key only.

**âš ï¸ Security Notice:** For security reasons, only safe navigation keys are allowed. Text typing and modifier keys (Ctrl, Alt, Win) are blocked to prevent unintended system operations.

- **Arguments:**
  - `key` (string): Key name.
    - **Allowed keys:** `enter`, `return`, `tab`, `escape`, `esc`, `space`, `backspace`, `delete`, `del`, `left`, `up`, `right`, `down`, `home`, `end`, `pageup`, `pagedown`
    - **Not allowed:** `ctrl`, `alt`, `win`, `shift` (blocked for security)
  - `action` (string): "click", "press" (hold down), "release" (let go) (default: "click")

- **Use Cases:**
  - Navigate forms using Tab key
  - Confirm actions with Enter
  - Close dialogs with Escape
  - Navigate lists and menus with arrow keys
  - Navigate pages with PageUp/PageDown

- **Note:** For text input, use mouse to focus a text field first. Direct text typing is not supported for security reasons.
```

**File:** docs/plan_20260214_accessibility_and_monitor.ja.md (L10-29)
```markdown
## 2. æ©Ÿèƒ½1: `read_window_text` (UIãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º)

### æ¦‚è¦
æŒ‡å®šã—ãŸã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®UIãƒ„ãƒªãƒ¼ã‚’è§£æã—ã€Markdownå½¢å¼ã§æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹ã€‚

### å®Ÿè£…è©³ç´°
- **ã‚µãƒ¼ãƒ“ã‚¹å**: `AccessibilityService` (æ–°è¦ä½œæˆ)
- **æŠ€è¡“è©³ç´°**:
    - `UIAutomationClient` ã¨ `UIAutomationTypes` (Windows Desktop SDKæ¨™æº–) ã‚’ä½¿ç”¨ã€‚
    - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ `TreeWalker.ControlViewWalker` ã‚’ä½¿ç”¨ã—ã¦ãƒ„ãƒªãƒ¼ã‚’èµ°æŸ»ã™ã‚‹ã€‚
    - ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ã¯ `Current.Name` ã ã‘ã§ãªãã€`ValuePattern` ã‚„ `TextPattern` ã‹ã‚‰ã®å–å¾—ã‚’è©¦ã¿ã‚‹ã€‚
- **Markdownå¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°**:
    - `ControlType.TitleBar`, `Header` -> `# ` (æ·±åº¦ã«å¿œã˜ã¦å¢—ã‚„ã™)
    - `ControlType.ListItem` -> `- `
    - `ControlType.Text`, `Edit`, `Document` -> ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ”¹è¡Œç¶­æŒï¼‰
    - `ControlType.Button` -> `[ Button: {Name} ]` (å¼•æ•°ã§æœ‰åŠ¹ãªå ´åˆ)
- **æ³¨æ„ç‚¹**: 
    - ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã®ãŸã‚ã€æœ€å¤§æ·±åº¦ã‚’10éšå±¤ã«åˆ¶é™ã€‚
    - ãƒ–ãƒ©ã‚¦ã‚¶ã®URLå–å¾—ã¯ã€ç‰¹å®šã®ã‚¨ãƒ‡ã‚£ãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆ"Address and search bar" ç­‰ï¼‰ã‚’æ¢ç´¢ã™ã‚‹ã“ã¨ã§ä»˜åŠ ä¾¡å€¤ã‚’é«˜ã‚ã‚‹ã€‚

```

**File:** docs/plan_20260214_token_efficiency_protocol.ja.md (L30-41)
```markdown
```json
"_llm_instruction": {
    "action": "PROCESS_IMMEDIATELY_AND_DISCARD",
    "steps": [
        "1. Extract metadata (ts, windowTitle).",
        "2. Analyze image NOW.",
        "3. Record result as TEXT only.",
        "4. DELETE the 'frame' or 'image' field from your history."
    ],
    "token_warning": "This image consumes approx 2000+ tokens. Discarding it saves 95% memory."
}
```
```

**File:** docs/plan_20260214_mcp_resources_buffering.ja.md (L6-10)
```markdown
## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦
- **ãƒãƒƒãƒ•ã‚¡**: ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ¡ãƒ¢ãƒªã¾ãŸã¯ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«ã€ç›´è¿‘ N ãƒ•ãƒ¬ãƒ¼ãƒ åˆ†ã®ç”»åƒã‚’ä¿æŒã™ã‚‹ã€‚
- **ãƒªã‚½ãƒ¼ã‚¹æä¾›**: MCP ã® `Resources` æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€å„ãƒ•ãƒ¬ãƒ¼ãƒ ã«ä¸€æ„ã® URIï¼ˆä¾‹: `mcp://video/frame/123.jpg`ï¼‰ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã€‚
- **ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰èª­ã¿è¾¼ã¿**: LLM ã¯é€šçŸ¥ï¼ˆNotificationsï¼‰ã§ URI ã ã‘ã‚’å—ã‘å–ã‚Šã€è©³ç´°ãªè§£æãŒå¿…è¦ãªå ´åˆã®ã¿ã€ãã® URI ã‚’èª­ã¿ã«è¡Œãã€‚

```

**File:** docs/report/qwencode_report.md (L9-28)
```markdown
### 1. `hwnd` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹å¤‰æ›´

- **å¤‰æ›´å‰**: `long` å‹ï¼ˆæ•´æ•°ï¼‰
- **å¤‰æ›´å¾Œ**: `string` å‹ï¼ˆæ–‡å­—åˆ—ï¼‰

#### ä¿®æ­£å¯¾è±¡ãƒ¡ã‚½ãƒƒãƒ‰

- `See` ãƒ¡ã‚½ãƒƒãƒ‰
- `StartWatching` ãƒ¡ã‚½ãƒƒãƒ‰
- `CloseWindow` ãƒ¡ã‚½ãƒƒãƒ‰

#### ä¿®æ­£ç†ç”±

- JSON çµŒç”±ã§ã®æ•°å€¤é€ä¿¡æ™‚ã«ã€`params/hwnd must be integer,null` ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å•é¡Œã‚’è§£æ¶ˆ
- æ•°å€¤ãŒæ–‡å­—åˆ—ã¨ã—ã¦ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã•ã‚Œã‚‹ç’°å¢ƒã«å¯¾å¿œ

#### ä¿®æ­£å†…å®¹è©³ç´°

- `long.TryParse` ã‚’ä½¿ç”¨ã—ã¦ã€æ–‡å­—åˆ—ã‹ã‚‰æ•´æ•°ã¸ã®å¤‰æ›ã‚’å®‰å…¨ã«è¡Œã†ã‚ˆã†ã«å¤‰æ›´
- ä»¥å‰ã®æ•´æ•°å½¢å¼ã‚‚å¼•ãç¶šãã‚µãƒãƒ¼ãƒˆ
```

**File:** docs/issue_20260214_qwen_video_coview_spec.md (L31-44)
```markdown
## ææ¡ˆä»•æ§˜ï¼šã€Œ2ç§’ã”ã¨ã®ãƒ‘ãƒ©ãƒ‘ãƒ©ç”»åƒ ï¼‹ åŒæœŸæ–‡å­—èµ·ã“ã—ã€
LLM ãŒæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«è‡ªç„¶ãªä¼šè©±ãŒã§ãã‚‹ã‚ˆã†ã€ä»¥ä¸‹ã®å‡ºåŠ›å½¢å¼ã‚’å®Ÿç¾ã—ã¾ã™ï¼š

### å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆNDJSON: Newline-Delimited JSONï¼‰
```json
{"ts": 0.0, "frame": "base64encoded_jpeg_without_newlines", "transcript": ""}
{"ts": 2.0, "frame": "...", "transcript": "ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™"}
{"ts": 4.0, "frame": "...", "transcript": "æœç‹ç”ºã®æœã "}
...
```
- `ts`: å†ç”Ÿé–‹å§‹ã‹ã‚‰ã®çµŒéæ™‚é–“ï¼ˆç§’å˜ä½ã€floatã€100ms ç²¾åº¦ä»¥ä¸Šï¼‰
- `frame`: JPEG base64ï¼ˆæ”¹è¡Œãªã—ã€RFC 4648æº–æ‹ ï¼‰â†’ `docs/feedback_20240614_base64_input_handling.md` ã®æ•™è¨“ã‚’åæ˜ 
- `transcript`: `listen(duration=2, source="System")` ã§å¾—ãŸæ–‡å­—èµ·ã“ã—ï¼ˆç©ºæ–‡å­—å¯ï¼‰
- å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¿…é ˆã§ã¯ãªãã€`transcript` ã¯éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œãªã„å ´åˆã¯ ""
```

**File:** docs/plan_20260214_timestamp_improvement_instruction.ja.md (L8-13)
```markdown
`watch_video` ãŠã‚ˆã³ `watch_video_v2` ã«ãŠã„ã¦ã€ã‚­ãƒ£ãƒ—ãƒãƒ£å‡¦ç†ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ï¼ˆ100msã€œ500msï¼‰ã«ã‚ˆã‚‹ã€Œç´¯ç©é…å»¶ã€ã¨ã€Œæ˜ åƒãƒ»éŸ³å£°ã®åŒæœŸã‚ºãƒ¬ã€ã‚’è§£æ¶ˆã™ã‚‹ã€‚

## 2. ä¿®æ­£æ–¹é‡
- **çµ¶å¯¾æ™‚åˆ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**: ãƒ«ãƒ¼ãƒ—é–‹å§‹æ™‚ã«ã€Œæ¬¡ã®ã‚­ãƒ£ãƒ—ãƒãƒ£äºˆå®šæ™‚åˆ» (`nextCaptureTime`)ã€ã‚’è¨ˆç®—ã—ã€ãã“ã¾ã§æ­£ç¢ºã«å¾…æ©Ÿã™ã‚‹ã€‚
- **å®Ÿæ¸¬ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—**: `ts` (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—) ã¯ã€ãƒ«ãƒ¼ãƒ—é–‹å§‹æ™‚ã§ã¯ãªãã€**ã‚­ãƒ£ãƒ—ãƒãƒ£å‡¦ç†ãŒå®Œäº†ã—ãŸç›´å¾Œã®æ™‚åˆ»**ã‚’ä½¿ç”¨ã—ã¦è¨ˆç®—ã™ã‚‹ã€‚

```

**File:** docs/DEVELOPMENT.md (L38-40)
```markdown
| **`WindowsDesktopUse.Audio`** | Hearing (Record) | Audio recording from system and microphone using WASAPI (NAudio). |
| **`WindowsDesktopUse.Transcription`** | Hearing (Analyze) | AI transcription using Whisper.net to convert audio to text. |
| **`WindowsDesktopUse.Input`** | Limbs (Control) | Low-level mouse and keyboard input simulation using the `SendInput` Win32 API. |
```

**File:** docs/DEVELOPMENT.md (L62-68)
```markdown
## Important: High DPI Awareness

This server calls `SetProcessDPIAware()` and operates in physical pixel units.
- Coordinates and sizes retrieved by the `Screen` module are in physical pixels.
- Mouse coordinates specified in the `Input` module are interpreted as physical pixels.
This design ensures that coordinates calculated by an AI from capture images match the input coordinates perfectly without any offset.

```

**File:** AGENTS.md (L49-52)
```markdown
### Logging - CRITICAL
**STRICT REQUIREMENT:** Always use `Console.Error.WriteLine` for logging.
**REASON:** `stdout` is reserved for JSON-RPC.

```
